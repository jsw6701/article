import{d as u,w as g}from"./DujhYGdh.js";import{r as d,l as h,a as S}from"./95k2wcHO.js";const n="auth_user",l="remember_me";function c(){if(typeof window>"u")return null;const r=localStorage.getItem(n);if(!r)return null;try{return JSON.parse(r)}catch{return null}}function T(){const r=typeof window<"u"?c():null,{subscribe:m,set:t,update:I}=g(r);return{subscribe:m,init(){const s=c();t(s)},async login(s,o,a=!1){try{console.log("[Auth] Calling apiLogin...");const e=await S({username:s,password:o,rememberMe:a});if(console.log("[Auth] apiLogin response:",e),e.success&&e.accessToken&&e.refreshToken&&e.userId&&e.username&&e.role){const f={userId:e.userId,username:e.username,role:e.role,accessToken:e.accessToken,refreshToken:e.refreshToken};return t(f),localStorage.setItem(n,JSON.stringify(f)),localStorage.setItem(l,JSON.stringify(a)),{success:!0,message:"로그인 성공",requiresTermsAgreement:e.requiresTermsAgreement??!1}}return{success:!1,message:e.message??"로그인 실패"}}catch{return{success:!1,message:"서버 오류가 발생했습니다."}}},async logout(){const s=c();if(s)try{await h(s.userId)}catch{}t(null),localStorage.removeItem(n),localStorage.removeItem(l)},clear(){t(null),localStorage.removeItem(n),localStorage.removeItem(l)},async refresh(){const s=c();if(!s)return!1;try{const o=await d(s.refreshToken);if(o.success&&o.accessToken&&o.refreshToken){const a={...s,accessToken:o.accessToken,refreshToken:o.refreshToken};return t(a),localStorage.setItem(n,JSON.stringify(a)),!0}return t(null),localStorage.removeItem(n),!1}catch{return t(null),localStorage.removeItem(n),!1}},getAccessToken(){return c()?.accessToken??null},isRememberMe(){if(typeof window>"u")return!1;try{return JSON.parse(localStorage.getItem(l)||"false")}catch{return!1}}}}const i=T(),p=u(i,r=>r!==null),w=u(i,r=>r),A=u(i,r=>r?.role==="ADMIN");export{A as a,i as b,w as c,p as i};
