import{f as G,a as y,c as na}from"../chunks/CSDkEukK.js";import"../chunks/G9K82XB2.js";import{o as ia}from"../chunks/D2Z1D5OA.js";import{p as oa,f as pe,t as w,g as e,a as da,c as s,o as l,Y as c,s as v,b as t,ao as Ue}from"../chunks/TeviCJ82.js";import{e as p,s as i}from"../chunks/DJUeCBpJ.js";import{i as T}from"../chunks/iMg5e8oI.js";import{e as we,i as Ae}from"../chunks/CqNPvWgI.js";import{r as Ne,s as $e}from"../chunks/B9lDzZO_.js";import{s as z}from"../chunks/C9eT_MQU.js";import{b as ca,s as Ce,a as pa}from"../chunks/DLP64Ruc.js";import{i as ua}from"../chunks/DgK7GOei.js";import{b as Re}from"../chunks/tyQMpd50.js";import{b as ue}from"../chunks/DFC9nrag.js";import{g as _a}from"../chunks/Du9Km8vb.js";import{m as fa,i as ma,c as ba,n as ga,o as ka,p as ha,q as ya,r as xa}from"../chunks/C8ccASB2.js";var Ma=G('<div class="loading svelte-1p497kv"><div class="spinner svelte-1p497kv"></div></div>'),Da=G('<div class="error svelte-1p497kv"><p> </p> <button class="svelte-1p497kv">다시 시도</button></div>'),Ga=G('<span class="search-tag svelte-1p497kv"> </span>'),Ia=G('<div class="user-card svelte-1p497kv"><div class="user-main svelte-1p497kv"><div class="user-info svelte-1p497kv"><span class="user-name svelte-1p497kv"> </span> <span> </span> <button> </button></div> <div class="user-details svelte-1p497kv"><span class="svelte-1p497kv"> </span> <span class="svelte-1p497kv"> </span> <span> </span></div> <div class="user-meta svelte-1p497kv"><span> </span></div></div> <div class="user-actions svelte-1p497kv"><button> </button> <button class="btn-delete svelte-1p497kv">삭제</button></div></div>'),Ua=G('<div class="pagination svelte-1p497kv"><button class="page-btn svelte-1p497kv">이전</button> <span class="page-info svelte-1p497kv"> </span> <button class="page-btn svelte-1p497kv">다음</button></div>'),wa=G('<div class="result-info svelte-1p497kv"><span> </span> <!></div> <div class="user-list svelte-1p497kv"></div> <!>',1),Aa=G('<div class="modal-overlay svelte-1p497kv"><div class="modal svelte-1p497kv"><h3 class="svelte-1p497kv">사용자 삭제</h3> <p class="svelte-1p497kv"><strong> </strong> 계정을 정말 삭제하시겠습니까?</p> <p class="warning svelte-1p497kv">이 작업은 되돌릴 수 없습니다.</p> <div class="modal-actions svelte-1p497kv"><button class="btn-cancel svelte-1p497kv">취소</button> <button class="btn-confirm-delete svelte-1p497kv"> </button></div></div></div>'),Na=G('<label><input type="radio" name="grade" class="svelte-1p497kv"/> <span class="grade-name svelte-1p497kv"> </span> <span class="grade-desc svelte-1p497kv"> </span></label>'),$a=G('<div class="modal-overlay svelte-1p497kv"><div class="modal svelte-1p497kv"><h3 class="svelte-1p497kv">회원 등급 변경</h3> <p class="svelte-1p497kv"><strong> </strong>님의 등급을 변경합니다.</p> <div class="grade-select svelte-1p497kv"></div> <div class="modal-actions svelte-1p497kv"><button class="btn-cancel svelte-1p497kv">취소</button> <button class="btn-confirm svelte-1p497kv"> </button></div></div></div>'),Ca=G('<div class="admin-page svelte-1p497kv"><header class="page-header svelte-1p497kv"><h1 class="svelte-1p497kv">유저 관리</h1> <nav class="admin-nav svelte-1p497kv"><a class="nav-item svelte-1p497kv">대시보드</a> <a class="nav-item active svelte-1p497kv">유저 관리</a></nav></header> <div class="search-bar svelte-1p497kv"><input type="text" placeholder="아이디로 검색..." class="svelte-1p497kv"/> <button class="svelte-1p497kv">검색</button></div> <!></div> <!> <!>',1);function Ka(Le,X){oa(X,!1);const Pe=[];let A=c([]),Y=c(0),N=c(1),Te=20,B=c(0),j=c(""),Z=c(""),ee=c(!0),F=c(null),d=c(null),ae=c(!1),$=c(null),te=c(!1),x=c(null),k=c(null),se=c([]),E=c(null);ia(()=>{const a=fa.subscribe(u=>{l(E,u?.userId??null)}),n=ma.subscribe(async u=>{if(u){const o=ba.subscribe(async I=>{if(!I){_a(`${ue}/`);return}await Promise.all([H(),Be()]),o()});n()}});return()=>{n(),a()}});async function Be(){try{l(se,await ga())}catch(a){console.error("등급 목록 로드 실패:",a)}}async function H(){l(ee,!0),l(F,null);try{const a=await ka({page:e(N),size:Te,search:e(j)||void 0});l(A,a.items),l(Y,a.total),l(B,a.totalPages)}catch(a){l(F,a?.message??"데이터를 불러오는데 실패했습니다")}finally{l(ee,!1)}}function _e(){l(j,e(Z)),l(N,1),H()}function fe(a){a<1||a>e(B)||(l(N,a),H())}async function Ee(a){if(e(d))return;if(a.id===e(E)){alert("자신의 권한은 변경할 수 없습니다.");return}const n=a.role==="ADMIN"?"USER":"ADMIN",u=n==="ADMIN"?`${a.username}님을 관리자로 변경하시겠습니까?`:`${a.username}님의 관리자 권한을 해제하시겠습니까?`;if(confirm(u)){l(d,a.id);try{await xa(a.id,n),l(A,e(A).map(o=>o.id===a.id?{...o,role:n}:o))}catch(o){alert(o?.message??"권한 변경에 실패했습니다")}finally{l(d,null)}}}function Se(a){if(a.id===e(E)){alert("자신의 계정은 삭제할 수 없습니다.");return}l($,a),l(ae,!0)}function le(){l(ae,!1),l($,null)}async function Ve(){if(!(!e($)||e(d))){l(d,e($).id);try{await ha(e($).id),l(A,e(A).filter(a=>a.id!==e($).id)),l(Y,e(Y)-1),le()}catch(a){alert(a?.message??"삭제에 실패했습니다")}finally{l(d,null)}}}function qe(a){return a==="ADMIN"?"role-admin":"role-user"}function me(a){return`grade-${a.toLowerCase()}`}function ze(a){l(x,a),l(k,a.grade),l(te,!0)}function J(){l(te,!1),l(x,null),l(k,null)}async function Ye(){if(!(!e(x)||!e(k)||e(d))){if(e(k)===e(x).grade){J();return}l(d,e(x).id);try{await ya(e(x).id,e(k));const a=e(se).find(n=>n.grade===e(k));l(A,e(A).map(n=>n.id===e(x).id?{...n,grade:e(k),gradeDisplayName:a?.displayName??e(k),gradeLevel:a?.level??1}:n)),J()}catch(a){alert(a?.message??"등급 변경에 실패했습니다")}finally{l(d,null)}}}ua();var be=Ca(),re=pe(be),ve=s(re),ge=v(s(ve),2),ke=s(ge),je=v(ke,2);t(ge),t(ve);var ne=v(ve,2),K=s(ne);Ne(K);var Fe=v(K,2);t(ne);var He=v(ne,2);{var Je=a=>{var n=Ma();y(a,n)},Ke=a=>{var n=na(),u=pe(n);{var o=M=>{var f=Da(),m=s(f),b=s(m,!0);t(m);var D=v(m,2);t(f),w(()=>i(b,e(F))),p("click",D,H),y(M,f)},I=M=>{var f=wa(),m=pe(f),b=s(m),D=s(b);t(b);var S=v(b,2);{var V=_=>{var r=Ga(),g=s(r);t(r),w(()=>i(g,`"${e(j)??""}" 검색 결과`)),y(_,r)};T(S,_=>{e(j)&&_(V)})}t(m);var h=v(m,2);we(h,5,()=>e(A),Ae,(_,r)=>{var g=Ia(),U=s(g),C=s(U),R=s(C),q=s(R,!0);t(R);var Q=v(R,2),Xe=s(Q,!0);t(Q);var W=v(Q,2),Ze=s(W,!0);t(W),t(C);var ie=v(C,2),oe=s(ie),ea=s(oe,!0);t(oe);var de=v(oe,2),aa=s(de,!0);t(de);var ce=v(de,2);let ye;var ta=s(ce,!0);t(ce),t(ie);var xe=v(ie,2),Me=s(xe),sa=s(Me);t(Me),t(xe),t(U);var De=v(U,2),P=s(De);let Ge;var la=s(P,!0);t(P);var Ie=v(P,2);t(De),t(g),w((ra,va)=>{i(q,e(r).username),z(Q,1,`role-badge ${ra??""}`,"svelte-1p497kv"),i(Xe,e(r).role),z(W,1,`grade-badge ${va??""}`,"svelte-1p497kv"),i(Ze,e(r).gradeDisplayName),i(ea,e(r).gender),i(aa,e(r).ageGroup),ye=z(ce,1,"email-verified svelte-1p497kv",null,ye,{verified:e(r).emailVerified}),i(ta,e(r).emailVerified?"인증됨":"미인증"),i(sa,`가입일: ${e(r).createdAt??""}`),Ge=z(P,1,"btn-role svelte-1p497kv",null,Ge,{loading:e(d)===e(r).id}),P.disabled=e(d)===e(r).id||e(r).id===e(E),i(la,e(r).role==="ADMIN"?"관리자 해제":"관리자 지정"),Ie.disabled=e(d)===e(r).id||e(r).id===e(E)},[()=>qe(e(r).role),()=>me(e(r).grade)]),p("click",W,()=>ze(e(r))),p("click",P,()=>Ee(e(r))),p("click",Ie,()=>Se(e(r))),y(_,g)}),t(h);var L=v(h,2);{var O=_=>{var r=Ua(),g=s(r),U=v(g,2),C=s(U);t(U);var R=v(U,2);t(r),w(()=>{g.disabled=e(N)===1,i(C,`${e(N)??""} / ${e(B)??""}`),R.disabled=e(N)===e(B)}),p("click",g,()=>fe(e(N)-1)),p("click",R,()=>fe(e(N)+1)),y(_,r)};T(L,_=>{e(B)>1&&_(O)})}w(()=>i(D,`총 ${e(Y)??""}명`)),y(M,f)};T(u,M=>{e(F)?M(o):M(I,!1)},!0)}y(a,n)};T(He,a=>{e(ee)?a(Je):a(Ke,!1)})}t(re);var he=v(re,2);{var Oe=a=>{var n=Aa(),u=s(n),o=v(s(u),2),I=s(o),M=s(I,!0);t(I),Ue(),t(o);var f=v(o,4),m=s(f),b=v(m,2),D=s(b,!0);t(b),t(f),t(u),t(n),w(()=>{i(M,e($).username),b.disabled=e(d)!==null,i(D,e(d)?"삭제 중...":"삭제")}),p("click",m,le),p("click",b,Ve),p("click",u,Ce(function(S){Re.call(this,X,S)})),p("click",n,le),y(a,n)};T(he,a=>{e(ae)&&e($)&&a(Oe)})}var Qe=v(he,2);{var We=a=>{var n=$a(),u=s(n),o=v(s(u),2),I=s(o),M=s(I,!0);t(I),Ue(),t(o);var f=v(o,2);we(f,5,()=>e(se),Ae,(V,h)=>{var L=Na();let O;var _=s(L);Ne(_);var r,g=v(_,2),U=s(g,!0);t(g);var C=v(g,2),R=s(C,!0);t(C),t(L),w(q=>{O=z(L,1,`grade-option ${q??""}`,"svelte-1p497kv",O,{selected:e(k)===e(h).grade}),r!==(r=e(h).grade)&&(_.value=(_.__value=e(h).grade)??""),i(U,e(h).displayName),i(R,e(h).description)},[()=>me(e(h).grade)]),pa(Pe,[],_,()=>(e(h).grade,e(k)),q=>l(k,q)),y(V,L)}),t(f);var m=v(f,2),b=s(m),D=v(b,2),S=s(D,!0);t(D),t(m),t(u),t(n),w(()=>{i(M,e(x).username),D.disabled=e(d)!==null||e(k)===e(x).grade,i(S,e(d)?"변경 중...":"변경")}),p("click",b,J),p("click",D,Ye),p("click",u,Ce(function(V){Re.call(this,X,V)})),p("click",n,J),y(a,n)};T(Qe,a=>{e(te)&&e(x)&&a(We)})}w(()=>{$e(ke,"href",`${ue??""}/admin`),$e(je,"href",`${ue??""}/admin/users`)}),ca(K,()=>e(Z),a=>l(Z,a)),p("keypress",K,a=>a.key==="Enter"&&_e()),p("click",Fe,_e),y(Le,be),da()}export{Ka as component};
