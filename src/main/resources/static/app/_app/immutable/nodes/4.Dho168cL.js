import{f as U,e as c,a as y,c as na,s as i}from"../chunks/DeXMNu7C.js";import{i as ia}from"../chunks/one-rmOF.js";import{y as oa,N as da,O as ca,P as _e,W as N,d as e,Q as pa,U as s,T as v,R as l,w as p,V as t,X as Ne}from"../chunks/_mKCt0Dg.js";import{i as E}from"../chunks/n77eKvsn.js";import{e as Ae,i as $e}from"../chunks/CfL7-1lS.js";import{t as ua,i as _a,b as fa,u as ba,v as ma,q as Re,s as Ce,w as ga,x as ka,y as ha}from"../chunks/25gMEqND.js";import{s as W}from"../chunks/DKK5T5rF.js";import{b as ya,s as Le,a as xa}from"../chunks/BvDqwZjj.js";import{b as fe}from"../chunks/kn-GG7-K.js";import{g as Ma}from"../chunks/BapkDQCs.js";function Pe(ee,L){var P=ee.$$events?.[L.type],x=oa(P)?P.slice():P==null?[]:[P];for(var T of x)T.call(this,L)}var wa=U('<div class="loading svelte-1p497kv"><div class="spinner svelte-1p497kv"></div></div>'),Da=U('<div class="error svelte-1p497kv"><p> </p> <button class="svelte-1p497kv">다시 시도</button></div>'),Ua=U('<span class="search-tag svelte-1p497kv"> </span>'),Ga=U('<div class="user-card svelte-1p497kv"><div class="user-main svelte-1p497kv"><div class="user-info svelte-1p497kv"><span class="user-name svelte-1p497kv"> </span> <span> </span> <button> </button></div> <div class="user-details svelte-1p497kv"><span class="svelte-1p497kv"> </span> <span class="svelte-1p497kv"> </span> <span> </span></div> <div class="user-meta svelte-1p497kv"><span> </span></div></div> <div class="user-actions svelte-1p497kv"><button> </button> <button class="btn-delete svelte-1p497kv">삭제</button></div></div>'),Ia=U('<div class="pagination svelte-1p497kv"><button class="page-btn svelte-1p497kv">이전</button> <span class="page-info svelte-1p497kv"> </span> <button class="page-btn svelte-1p497kv">다음</button></div>'),Na=U('<div class="result-info svelte-1p497kv"><span> </span> <!></div> <div class="user-list svelte-1p497kv"></div> <!>',1),Aa=U('<div class="modal-overlay svelte-1p497kv"><div class="modal svelte-1p497kv"><h3 class="svelte-1p497kv">사용자 삭제</h3> <p class="svelte-1p497kv"><strong> </strong> 계정을 정말 삭제하시겠습니까?</p> <p class="warning svelte-1p497kv">이 작업은 되돌릴 수 없습니다.</p> <div class="modal-actions svelte-1p497kv"><button class="btn-cancel svelte-1p497kv">취소</button> <button class="btn-confirm-delete svelte-1p497kv"> </button></div></div></div>'),$a=U('<label><input type="radio" name="grade" class="svelte-1p497kv"/> <span class="grade-name svelte-1p497kv"> </span> <span class="grade-desc svelte-1p497kv"> </span></label>'),Ra=U('<div class="modal-overlay svelte-1p497kv"><div class="modal svelte-1p497kv"><h3 class="svelte-1p497kv">회원 등급 변경</h3> <p class="svelte-1p497kv"><strong> </strong>님의 등급을 변경합니다.</p> <div class="grade-select svelte-1p497kv"></div> <div class="modal-actions svelte-1p497kv"><button class="btn-cancel svelte-1p497kv">취소</button> <button class="btn-confirm svelte-1p497kv"> </button></div></div></div>'),Ca=U('<div class="admin-page svelte-1p497kv"><header class="page-header svelte-1p497kv"><h1 class="svelte-1p497kv">유저 관리</h1> <nav class="admin-nav svelte-1p497kv"><a class="nav-item svelte-1p497kv">대시보드</a> <a class="nav-item active svelte-1p497kv">유저 관리</a></nav></header> <div class="search-bar svelte-1p497kv"><input type="text" placeholder="아이디로 검색..." class="svelte-1p497kv"/> <button class="svelte-1p497kv">검색</button></div> <!></div> <!> <!>',1);function Qa(ee,L){da(L,!1);const P=[];let x=p([]),T=p(0),A=p(1),Te=20,S=p(0),X=p(""),ae=p(""),te=p(!0),j=p(null),d=p(null),se=p(!1),$=p(null),le=p(!1),M=p(null),k=p(null),re=p([]),q=p(null);ca(()=>{const a=ua.subscribe(u=>{l(q,u?.userId??null)}),n=_a.subscribe(async u=>{if(u){const o=fa.subscribe(async G=>{if(!G){Ma(`${fe}/`);return}await Promise.all([F(),Ve()]),o()});n()}});return()=>{n(),a()}});async function Ve(){try{l(re,await ba())}catch(a){console.error("등급 목록 로드 실패:",a)}}async function F(){l(te,!0),l(j,null);try{const a=await ma({page:e(A),size:Te,search:e(X)||void 0});l(x,a.items),l(T,a.total),l(S,a.totalPages)}catch(a){l(j,a?.message??"데이터를 불러오는데 실패했습니다")}finally{l(te,!1)}}function be(){l(X,e(ae)),l(A,1),F()}function me(a){a<1||a>e(S)||(l(A,a),F())}async function Be(a){if(e(d))return;if(a.id===e(q)){alert("자신의 권한은 변경할 수 없습니다.");return}const n=a.role==="ADMIN"?"USER":"ADMIN",u=n==="ADMIN"?`${a.username}님을 관리자로 변경하시겠습니까?`:`${a.username}님의 관리자 권한을 해제하시겠습니까?`;if(confirm(u)){l(d,a.id);try{await ha(a.id,n),l(x,e(x).map(o=>o.id===a.id?{...o,role:n}:o))}catch(o){alert(o?.message??"권한 변경에 실패했습니다")}finally{l(d,null)}}}function Ee(a){if(a.id===e(q)){alert("자신의 계정은 삭제할 수 없습니다.");return}l($,a),l(se,!0)}function ve(){l(se,!1),l($,null)}async function Se(){if(!(!e($)||e(d))){l(d,e($).id);try{await ga(e($).id),l(x,e(x).filter(a=>a.id!==e($).id)),l(T,e(T)-1),ve()}catch(a){alert(a?.message??"삭제에 실패했습니다")}finally{l(d,null)}}}function qe(a){return a==="ADMIN"?"role-admin":"role-user"}function ge(a){return`grade-${a.toLowerCase()}`}function ze(a){l(M,a),l(k,a.grade),l(le,!0)}function H(){l(le,!1),l(M,null),l(k,null)}async function Oe(){if(!(!e(M)||!e(k)||e(d))){if(e(k)===e(M).grade){H();return}l(d,e(M).id);try{await ka(e(M).id,e(k));const a=e(re).find(n=>n.grade===e(k));l(x,e(x).map(n=>n.id===e(M).id?{...n,grade:e(k),gradeDisplayName:a?.displayName??e(k),gradeLevel:a?.level??1}:n)),H()}catch(a){alert(a?.message??"등급 변경에 실패했습니다")}finally{l(d,null)}}}ia();var ke=Ca(),ne=_e(ke),ie=s(ne),he=v(s(ie),2),ye=s(he),Qe=v(ye,2);t(he),t(ie);var oe=v(ie,2),J=s(oe);Re(J);var We=v(J,2);t(oe);var Xe=v(oe,2);{var je=a=>{var n=wa();y(a,n)},Fe=a=>{var n=na(),u=_e(n);{var o=w=>{var f=Da(),b=s(f),m=s(b,!0);t(b);var D=v(b,2);t(f),N(()=>i(m,e(j))),c("click",D,F),y(w,f)},G=w=>{var f=Na(),b=_e(f),m=s(b),D=s(m);t(m);var z=v(m,2);{var O=_=>{var r=Ua(),g=s(r);t(r),N(()=>i(g,`"${e(X)??""}" 검색 결과`)),y(_,r)};E(z,_=>{e(X)&&_(O)})}t(b);var h=v(b,2);Ae(h,5,()=>e(x),$e,(_,r)=>{var g=Ga(),I=s(g),R=s(I),C=s(R),Q=s(C,!0);t(C);var Y=v(C,2),Ye=s(Y,!0);t(Y);var Z=v(Y,2),Ze=s(Z,!0);t(Z),t(R);var de=v(R,2),ce=s(de),ea=s(ce,!0);t(ce);var pe=v(ce,2),aa=s(pe,!0);t(pe);var ue=v(pe,2);let Me;var ta=s(ue,!0);t(ue),t(de);var we=v(de,2),De=s(we),sa=s(De);t(De),t(we),t(I);var Ue=v(I,2),B=s(Ue);let Ge;var la=s(B,!0);t(B);var Ie=v(B,2);t(Ue),t(g),N((ra,va)=>{i(Q,e(r).username),W(Y,1,`role-badge ${ra??""}`,"svelte-1p497kv"),i(Ye,e(r).role),W(Z,1,`grade-badge ${va??""}`,"svelte-1p497kv"),i(Ze,e(r).gradeDisplayName),i(ea,e(r).gender),i(aa,e(r).ageGroup),Me=W(ue,1,"email-verified svelte-1p497kv",null,Me,{verified:e(r).emailVerified}),i(ta,e(r).emailVerified?"인증됨":"미인증"),i(sa,`가입일: ${e(r).createdAt??""}`),Ge=W(B,1,"btn-role svelte-1p497kv",null,Ge,{loading:e(d)===e(r).id}),B.disabled=e(d)===e(r).id||e(r).id===e(q),i(la,e(r).role==="ADMIN"?"관리자 해제":"관리자 지정"),Ie.disabled=e(d)===e(r).id||e(r).id===e(q)},[()=>qe(e(r).role),()=>ge(e(r).grade)]),c("click",Z,()=>ze(e(r))),c("click",B,()=>Be(e(r))),c("click",Ie,()=>Ee(e(r))),y(_,g)}),t(h);var V=v(h,2);{var K=_=>{var r=Ia(),g=s(r),I=v(g,2),R=s(I);t(I);var C=v(I,2);t(r),N(()=>{g.disabled=e(A)===1,i(R,`${e(A)??""} / ${e(S)??""}`),C.disabled=e(A)===e(S)}),c("click",g,()=>me(e(A)-1)),c("click",C,()=>me(e(A)+1)),y(_,r)};E(V,_=>{e(S)>1&&_(K)})}N(()=>i(D,`총 ${e(T)??""}명`)),y(w,f)};E(u,w=>{e(j)?w(o):w(G,!1)},!0)}y(a,n)};E(Xe,a=>{e(te)?a(je):a(Fe,!1)})}t(ne);var xe=v(ne,2);{var He=a=>{var n=Aa(),u=s(n),o=v(s(u),2),G=s(o),w=s(G,!0);t(G),Ne(),t(o);var f=v(o,4),b=s(f),m=v(b,2),D=s(m,!0);t(m),t(f),t(u),t(n),N(()=>{i(w,e($).username),m.disabled=e(d)!==null,i(D,e(d)?"삭제 중...":"삭제")}),c("click",b,ve),c("click",m,Se),c("click",u,Le(function(z){Pe.call(this,L,z)})),c("click",n,ve),y(a,n)};E(xe,a=>{e(se)&&e($)&&a(He)})}var Je=v(xe,2);{var Ke=a=>{var n=Ra(),u=s(n),o=v(s(u),2),G=s(o),w=s(G,!0);t(G),Ne(),t(o);var f=v(o,2);Ae(f,5,()=>e(re),$e,(O,h)=>{var V=$a();let K;var _=s(V);Re(_);var r,g=v(_,2),I=s(g,!0);t(g);var R=v(g,2),C=s(R,!0);t(R),t(V),N(Q=>{K=W(V,1,`grade-option ${Q??""}`,"svelte-1p497kv",K,{selected:e(k)===e(h).grade}),r!==(r=e(h).grade)&&(_.value=(_.__value=e(h).grade)??""),i(I,e(h).displayName),i(C,e(h).description)},[()=>ge(e(h).grade)]),xa(P,[],_,()=>(e(h).grade,e(k)),Q=>l(k,Q)),y(O,V)}),t(f);var b=v(f,2),m=s(b),D=v(m,2),z=s(D,!0);t(D),t(b),t(u),t(n),N(()=>{i(w,e(M).username),D.disabled=e(d)!==null||e(k)===e(M).grade,i(z,e(d)?"변경 중...":"변경")}),c("click",m,H),c("click",D,Oe),c("click",u,Le(function(O){Pe.call(this,L,O)})),c("click",n,H),y(a,n)};E(Je,a=>{e(le)&&e(M)&&a(Ke)})}N(()=>{Ce(ye,"href",`${fe??""}/admin`),Ce(Qe,"href",`${fe??""}/admin/users`)}),ya(J,()=>e(ae),a=>l(ae,a)),c("keypress",J,a=>a.key==="Enter"&&be()),c("click",We,be),y(ee,ke),pa()}export{Qa as component};
