import{y as h,az as k,aA as y,a2 as T,aB as S,aC as _,aD as v,aE as m,aF as w}from"./C_qc7GMT.js";const E=Symbol("is custom element"),O=Symbol("is html");function B(e){if(h){var t=!1,n=()=>{if(!t){if(t=!0,e.hasAttribute("value")){var s=e.value;d(e,"value",null),e.value=s}if(e.hasAttribute("checked")){var r=e.checked;d(e,"checked",null),e.checked=r}}};e.__on_r=n,T(n),S()}}function d(e,t,n,s){var r=A(e);h&&(r[t]=e.getAttribute(t),t==="src"||t==="srcset"||t==="href"&&e.nodeName==="LINK")||r[t]!==(r[t]=n)&&(t==="loading"&&(e[_]=n),n==null?e.removeAttribute(t):typeof n!="string"&&I(e).includes(t)?e[t]=n:e.setAttribute(t,n))}function A(e){return e.__attributes??={[E]:e.nodeName.includes("-"),[O]:e.namespaceURI===k}}var l=new Map;function I(e){var t=e.getAttribute("is")||e.nodeName,n=l.get(t);if(n)return n;l.set(t,n=[]);for(var s,r=e,o=Element.prototype;o!==r;){s=v(r);for(var c in s)s[c].set&&n.push(c);r=y(r)}return n}const N="",g="auth_user";function b(){if(typeof window>"u")return null;const e=localStorage.getItem(g);if(!e)return null;try{return JSON.parse(e)?.accessToken??null}catch{return null}}function $(){typeof window<"u"&&(localStorage.removeItem(g),window.dispatchEvent(new CustomEvent("auth:expired")))}function u(e){const t=new URLSearchParams;Object.entries(e).forEach(([s,r])=>{r==null||r===""||t.set(s,String(r))});const n=t.toString();return n?`?${n}`:""}async function a(e,t,n=!1){const s={...t?.headers??{}};if(n){const o=b();o&&(s.Authorization=`Bearer ${o}`)}const r=await fetch(`${N}${e}`,{...t,headers:s});if(r.status===401&&n)throw $(),new Error("인증이 만료되었습니다. 다시 로그인해주세요.");if(!r.ok){const o=await r.text().catch(()=>"");throw new Error(`API ${r.status} ${r.statusText}: ${o}`)}return await r.json()}function M(e){return a(`/api/cards${u({group:e.group,status:e.status??"ACTIVE",from:e.from,to:e.to,limit:e.limit,offset:e.offset})}`,void 0,!0)}function U(e){return a(`/api/cards/${e}`,void 0,!0)}function x(e=7){return a(`/api/cards/today${u({limit:e})}`,void 0,!0)}function R(e={}){return a(`/api/trending${u({hours:e.hours??3,limit:e.limit??10})}`,void 0,!0)}function D(e={}){return a(`/api/trending/popular${u({limit:e.limit??10})}`,void 0,!0)}function G(e){return a("/api/auth/email/send-verification",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})}function H(e){return a("/api/auth/email/verify",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})}function K(e){return a("/api/auth/signup",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})}function C(e){return a("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})}function Y(e){return a(`/api/auth/check-username${u({username:e})}`)}function P(e){return a("/api/auth/refresh",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refreshToken:e})})}function J(e){return a("/api/auth/logout",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:e})})}function z(e){return a(`/api/bookmarks/${e}`,{method:"POST"},!0)}function V(e){return a(`/api/bookmarks/${e}`,{method:"DELETE"},!0)}function q(e){return a(`/api/bookmarks/${e}/status`,void 0,!0)}function F(){return a("/api/bookmarks",void 0,!0)}const i="auth_user";function f(){if(typeof window>"u")return null;const e=localStorage.getItem(i);if(!e)return null;try{return JSON.parse(e)}catch{return null}}function j(){const{subscribe:e,set:t,update:n}=w(null);return{subscribe:e,init(){const s=f();s&&t(s)},async login(s,r){try{const o=await C({username:s,password:r});if(o.success&&o.accessToken&&o.refreshToken&&o.userId&&o.username){const c={userId:o.userId,username:o.username,accessToken:o.accessToken,refreshToken:o.refreshToken};return t(c),localStorage.setItem(i,JSON.stringify(c)),{success:!0,message:"로그인 성공"}}return{success:!1,message:o.message??"로그인 실패"}}catch{return{success:!1,message:"서버 오류가 발생했습니다."}}},async logout(){const s=f();if(s)try{await J(s.userId)}catch{}t(null),localStorage.removeItem(i)},clear(){t(null)},async refresh(){const s=f();if(!s)return!1;try{const r=await P(s.refreshToken);if(r.success&&r.accessToken&&r.refreshToken){const o={...s,accessToken:r.accessToken,refreshToken:r.refreshToken};return t(o),localStorage.setItem(i,JSON.stringify(o)),!0}return t(null),localStorage.removeItem(i),!1}catch{return t(null),localStorage.removeItem(i),!1}},getAccessToken(){return f()?.accessToken??null}}}const p=j(),Q=m(p,e=>e!==null),W=m(p,e=>e);export{D as a,F as b,p as c,B as d,U as e,q as f,R as g,z as h,Q as i,Y as j,G as k,M as l,K as m,W as n,V as r,d as s,x as t,H as v};
