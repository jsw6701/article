import{d as u,w as g}from"./DujhYGdh.js";import{r as d,l as S,a as T}from"./Do2HDaJV.js";const n="auth_user",l="remember_me";function c(){if(typeof window>"u")return null;const s=localStorage.getItem(n);if(!s)return null;try{return JSON.parse(s)}catch{return null}}function h(){const s=typeof window<"u"?c():null,{subscribe:m,set:t,update:I}=g(s);return{subscribe:m,init(){const r=c();t(r)},async login(r,o,a=!1){try{const e=await T({username:r,password:o,rememberMe:a});if(e.success&&e.accessToken&&e.refreshToken&&e.userId&&e.username&&e.role){const f={userId:e.userId,username:e.username,role:e.role,accessToken:e.accessToken,refreshToken:e.refreshToken};return t(f),localStorage.setItem(n,JSON.stringify(f)),localStorage.setItem(l,JSON.stringify(a)),{success:!0,message:"로그인 성공",requiresTermsAgreement:e.requiresTermsAgreement??!1}}return{success:!1,message:e.message??"로그인 실패"}}catch{return{success:!1,message:"서버 오류가 발생했습니다."}}},async logout(){const r=c();if(r)try{await S(r.userId)}catch{}t(null),localStorage.removeItem(n),localStorage.removeItem(l)},clear(){t(null),localStorage.removeItem(n),localStorage.removeItem(l)},async refresh(){const r=c();if(!r)return!1;try{const o=await d(r.refreshToken);if(o.success&&o.accessToken&&o.refreshToken){const a={...r,accessToken:o.accessToken,refreshToken:o.refreshToken};return t(a),localStorage.setItem(n,JSON.stringify(a)),!0}return t(null),localStorage.removeItem(n),!1}catch{return t(null),localStorage.removeItem(n),!1}},getAccessToken(){return c()?.accessToken??null},isRememberMe(){if(typeof window>"u")return!1;try{return JSON.parse(localStorage.getItem(l)||"false")}catch{return!1}}}}const i=h(),w=u(i,s=>s!==null),p=u(i,s=>s),v=u(i,s=>s?.role==="ADMIN");export{v as a,i as b,p as c,w as i};
