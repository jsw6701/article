import{d as u,w as f}from"./BkEP4YsV.js";import{r as i,l as g,a as m}from"./ccHZqE28.js";const o="auth_user";function c(){if(typeof window>"u")return null;const r=localStorage.getItem(o);if(!r)return null;try{return JSON.parse(r)}catch{return null}}function d(){const{subscribe:r,set:n,update:T}=f(null);return{subscribe:r,init(){const s=c();s&&n(s)},async login(s,t){try{const e=await m({username:s,password:t});if(e.success&&e.accessToken&&e.refreshToken&&e.userId&&e.username){const a={userId:e.userId,username:e.username,accessToken:e.accessToken,refreshToken:e.refreshToken};return n(a),localStorage.setItem(o,JSON.stringify(a)),{success:!0,message:"로그인 성공"}}return{success:!1,message:e.message??"로그인 실패"}}catch{return{success:!1,message:"서버 오류가 발생했습니다."}}},async logout(){const s=c();if(s)try{await g(s.userId)}catch{}n(null),localStorage.removeItem(o)},async refresh(){const s=c();if(!s)return!1;try{const t=await i(s.refreshToken);if(t.success&&t.accessToken&&t.refreshToken){const e={...s,accessToken:t.accessToken,refreshToken:t.refreshToken};return n(e),localStorage.setItem(o,JSON.stringify(e)),!0}return n(null),localStorage.removeItem(o),!1}catch{return n(null),localStorage.removeItem(o),!1}},getAccessToken(){return c()?.accessToken??null}}}const l=d(),S=u(l,r=>r!==null),I=u(l,r=>r);export{l as a,I as c,S as i};
