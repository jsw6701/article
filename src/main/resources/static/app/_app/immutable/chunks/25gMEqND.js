import{h as g,aA as T,aB as y,q as S,aC as k,aD as v,aE as A,aF as f,aG as _}from"./_mKCt0Dg.js";const w=Symbol("is custom element"),E=Symbol("is html");function L(e){if(g){var t=!1,o=()=>{if(!t){if(t=!0,e.hasAttribute("value")){var n=e.value;m(e,"value",null),e.value=n}if(e.hasAttribute("checked")){var r=e.checked;m(e,"checked",null),e.checked=r}}};e.__on_r=o,S(o),k()}}function m(e,t,o,n){var r=O(e);g&&(r[t]=e.getAttribute(t),t==="src"||t==="srcset"||t==="href"&&e.nodeName==="LINK")||r[t]!==(r[t]=o)&&(t==="loading"&&(e[v]=o),o==null?e.removeAttribute(t):typeof o!="string"&&I(e).includes(t)?e[t]=o:e.setAttribute(t,o))}function O(e){return e.__attributes??={[w]:e.nodeName.includes("-"),[E]:e.namespaceURI===T}}var h=new Map;function I(e){var t=e.getAttribute("is")||e.nodeName,o=h.get(t);if(o)return o;h.set(t,o=[]);for(var n,r=e,a=Element.prototype;a!==r;){n=A(r);for(var c in n)n[c].set&&o.push(c);r=y(r)}return o}const $="",p="auth_user";function b(){if(typeof window>"u")return null;const e=localStorage.getItem(p);if(!e)return null;try{return JSON.parse(e)?.accessToken??null}catch{return null}}function N(){typeof window<"u"&&(localStorage.removeItem(p),window.dispatchEvent(new CustomEvent("auth:expired")))}function i(e){const t=new URLSearchParams;Object.entries(e).forEach(([n,r])=>{r==null||r===""||t.set(n,String(r))});const o=t.toString();return o?`?${o}`:""}async function s(e,t,o=!1){const n={...t?.headers??{}};if(o){const a=b();a&&(n.Authorization=`Bearer ${a}`)}const r=await fetch(`${$}${e}`,{...t,headers:n});if(r.status===401&&o)throw N(),new Error("인증이 만료되었습니다. 다시 로그인해주세요.");if(!r.ok){const a=await r.text().catch(()=>"");throw new Error(`API ${r.status} ${r.statusText}: ${a}`)}return await r.json()}function B(e){return s(`/api/cards${i({group:e.group,status:e.status??"ACTIVE",from:e.from,to:e.to,limit:e.limit??20,offset:e.offset??0})}`,void 0,!0)}function G(e){return s(`/api/cards/${e}`,void 0,!0)}function M(e={}){return s(`/api/trending${i({hours:e.hours??3,limit:e.limit??10})}`,void 0,!0)}function x(e={}){return s(`/api/trending/popular${i({limit:e.limit??10})}`,void 0,!0)}function D(e){return s("/api/auth/email/send-verification",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})}function R(e){return s("/api/auth/email/verify",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})}function H(e){return s("/api/auth/signup",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})}function C(e){return s("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})}function z(e){return s(`/api/auth/check-username${i({username:e})}`)}function P(e){return s("/api/auth/refresh",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refreshToken:e})})}function J(e){return s("/api/auth/logout",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:e})})}function q(e){return s(`/api/bookmarks/${e}`,{method:"POST"},!0)}function K(e){return s(`/api/bookmarks/${e}`,{method:"DELETE"},!0)}function V(e){return s(`/api/bookmarks/${e}/status`,void 0,!0)}function Y(){return s("/api/bookmarks",void 0,!0)}function F(){return s("/api/admin/dashboard",void 0,!0)}function Q(e=30){return s(`/api/admin/stats/signups${i({days:e})}`,void 0,!0)}function W(e=30){return s(`/api/admin/stats/views${i({days:e})}`,void 0,!0)}function X(){return s("/api/admin/stats/gender",void 0,!0)}function Z(){return s("/api/admin/stats/age-groups",void 0,!0)}function ee(e={}){return s(`/api/admin/users${i({page:e.page??1,size:e.size??20,search:e.search})}`,void 0,!0)}function te(e,t){return s(`/api/admin/users/${e}/role`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({role:t})},!0)}function re(e){return s(`/api/admin/users/${e}`,{method:"DELETE"},!0)}function se(){return s("/api/admin/grades",void 0,!0)}function ne(){return s("/api/admin/stats/grades",void 0,!0)}function ae(e,t){return s(`/api/admin/users/${e}/grade`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({grade:t})},!0)}const u="auth_user";function d(){if(typeof window>"u")return null;const e=localStorage.getItem(u);if(!e)return null;try{return JSON.parse(e)}catch{return null}}function U(){const{subscribe:e,set:t,update:o}=_(null);return{subscribe:e,init(){const n=d();n&&t(n)},async login(n,r){try{const a=await C({username:n,password:r});if(a.success&&a.accessToken&&a.refreshToken&&a.userId&&a.username&&a.role){const c={userId:a.userId,username:a.username,role:a.role,accessToken:a.accessToken,refreshToken:a.refreshToken};return t(c),localStorage.setItem(u,JSON.stringify(c)),{success:!0,message:"로그인 성공"}}return{success:!1,message:a.message??"로그인 실패"}}catch{return{success:!1,message:"서버 오류가 발생했습니다."}}},async logout(){const n=d();if(n)try{await J(n.userId)}catch{}t(null),localStorage.removeItem(u)},clear(){t(null)},async refresh(){const n=d();if(!n)return!1;try{const r=await P(n.refreshToken);if(r.success&&r.accessToken&&r.refreshToken){const a={...n,accessToken:r.accessToken,refreshToken:r.refreshToken};return t(a),localStorage.setItem(u,JSON.stringify(a)),!0}return t(null),localStorage.removeItem(u),!1}catch{return t(null),localStorage.removeItem(u),!1}},getAccessToken(){return d()?.accessToken??null}}}const l=U(),oe=f(l,e=>e!==null),ie=f(l,e=>e),ue=f(l,e=>e?.role==="ADMIN");export{D as A,H as B,R as C,x as a,ue as b,F as c,Q as d,W as e,X as f,M as g,Z as h,oe as i,ne as j,Y as k,B as l,G as m,V as n,q as o,l as p,L as q,K as r,m as s,ie as t,se as u,ee as v,re as w,ae as x,te as y,z};
